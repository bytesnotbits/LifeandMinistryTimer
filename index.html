<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:,">
    <title>Life and Ministry Timer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .progress-bar span {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: #000000
        }
        .part-card {
            border: 2px solid #000000; /* Initial 2px black border */
            transition: border-color 0.2s ease, border-width 0.2s ease;
            will-change: transform, border-color, border-width;
        }
        
        #commentSection {
            transition: all 0.3s ease;
        }
        #commentHistory::-webkit-scrollbar {
            width: 6px;
        }
        
        #commentHistory::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        #commentHistory::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        #commentHistory::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .progress-bar {
            position: relative;
            display: flex;
            align-items: center;
        }
    </style>
</head>

<body class="bg-gray-100 p-4">
    <main class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">

<!---  Template Section --->

        <section aria-labelledby="template-heading" class="space-y-6">
            <header class="flex justify-between items-center">
                <h1 id="template-heading" class="text-xl font-bold">Meeting Template</h1>
                <div class="space-x-2">
                    <button 
                        onclick="resetData()" 
                        class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
                        aria-label="Reset all timers">
                        Reset Timers
                    </button>
                    <button 
                        onclick="clearLocalStorage()" 
                        class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                        aria-label="Clear template and reset all data">
                        Clear Template
                    </button>
                </div>
            </header>
            
            <div id="partsTemplate" class="space-y-2" role="form" aria-label="Meeting parts template">
                <!-- Parts will be rendered here -->
            </div>
            
            <button 
                onclick="addPart()" 
                class="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                aria-label="Add new meeting part">
                Add Part
            </button>
        </section>

<!--- Comment History Section --->

        <section aria-labelledby="comment-heading" class="mt-8 p-4 bg-gray-50 rounded-lg">
            <h2 id="comment-heading" class="text-lg font-bold mb-4">Comment History</h2>
            <div id="globalCommentStats" class="mb-4">
                <p>Total Comments: <span id="globalCommentCount" class="font-semibold" aria-live="polite">0</span></p>
                <p>Average Duration: <span id="globalAverageDuration" class="font-semibold" aria-live="polite">0:00</span></p>
            </div>
            <div id="commentHistory" 
                 class="space-y-2 max-h-40 overflow-y-auto"
                 role="log" 
                 aria-label="Comment history list">
                <!-- Comments will be listed here -->
            </div>
        </section>
        
        <!-- Timer Display Section -->
        <section aria-labelledby="timer-heading" class="space-y-4 mt-8">
            <h2 id="timer-heading" class="text-xl font-bold">Meeting Timer</h2>
            <div id="partsDisplay" 
                 class="space-y-4"
                 role="region" 
                 aria-label="Active timers">
                <!-- Timer displays will be inserted here -->
            </div>
        </section>
    </main>
    
    <footer class="bg-gray-100 p-4 text-sm text-center">
    <!-- Other footer content -->
    01/2025 Version: 1.0.0
</footer>
</body>

    <script>
//---------------------------------------------------------------------------------------------- 
//----------------------------------------------------------------------------------------------
// BEGIN DOM CACHE
const DOM = {
    partsTemplate: null,
    partsDisplay: null,
    commentHistory: null,
    globalCommentCount: null,
    globalAverageDuration: null,
    init() {
        this.partsTemplate = document.getElementById('partsTemplate');
        this.partsDisplay = document.getElementById('partsDisplay');
        this.commentHistory = document.getElementById('commentHistory');
        this.globalCommentCount = document.getElementById('globalCommentCount');
        this.globalAverageDuration = document.getElementById('globalAverageDuration');
    }
};

// END DOM CACHE
//----------------------------------------------------------------------------------------------  
//----------------------------------------------------------------------------------------------        
// BEGIN UTILITY FUNCTIONS
        
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

function trackError(fn, context = 'unknown') {
    return function(...args) {
        try {
            return fn.apply(this, args);
        } catch (error) {
            console.error(`Error in ${context}:`, error);
            // You could add additional error handling here, like sending to an error tracking service
            throw error; // Re-throw to maintain original behavior
        }
    };
}

    // Clear performance monitoring data
    performanceMonitor.renderTimes.clear();
    
    // Save state before cleanup
    if (isRunning) {
        saveState();
    }
}

function initializeApplication() {
    // Initialize DOM cache
    DOM.init();
    
    // Load saved data
    loadTemplate();
    loadState();
    
    // Initialize UI
    render.comments();
    render.timerDisplay();
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && e.target === document.body) {
            e.preventDefault();
            toggleTimer();
        }
    });
}

// Event Listeners
document.addEventListener('DOMContentLoaded', initializeApplication);

document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        cleanupResources();
    }
});

window.addEventListener('beforeunload', (e) => {
    cleanupResources();
    if (isRunning) {
        e.preventDefault();
        e.returnValue = '';
    }
});

window.addEventListener('error', (event) => {
    console.error('Global error caught:', {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        error: event.error
    });
    
    // Attempt recovery
    try {
        resetData();
        render.template();
        render.timerDisplay();
        alert('An error occurred. The application has been reset.');
    } catch (recoveryError) {
        console.error('Recovery failed:', recoveryError);
        alert('Application error. Please refresh the page.');
    }
});
  
// END APPLICATION LIFECYCLE MANAGEMENT
//---------------------------------------------------------------------------------------------- 

    </script>
</body>
</html>
