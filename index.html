<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (head section remains unchanged) ... -->
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">
        <div class="space-y-6">
            <!-- Template Management (unchanged) -->
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Meeting Template</h2>
                    <div class="space-x-2">
                        <button onclick="resetData()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
                            Reset Timers
                        </button>
                        <button onclick="clearLocalStorage()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">
                            Clear Template
                        </button>
                    </div>
                </div>
                
                <div id="partsTemplate" class="space-y-4">
                    <!-- Parts will be inserted here -->
                </div>
                
                <button onclick="addPart()" class="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    Add Part
                </button>
            </div>

            <!-- Timer Display Section -->
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Meeting Timer</h2>
                    <!-- REMOVED BUTTONS FROM HERE -->
                </div>
                <div id="partsDisplay" class="space-y-4">
                    <!-- Timer displays will be inserted here -->
                </div>
            </div>

            <!-- Comment Tracking (unchanged) -->
            <div id="commentSection" class="space-y-4 hidden">
                <!-- ... (comment section unchanged) ... -->
            </div>
        </div>
    </div>

    <script>
        // ... (Constants and utility functions remain unchanged) ...
    function renderTemplate() {
        const container = document.getElementById('partsTemplate');
        if (!container) return;
        
        container.innerHTML = meetingParts.map((part, index) => `
            <div class="flex items-center space-x-2">
                <div class="flex-1 grid grid-cols-3 gap-2">
                    <input
                        value="${part.name}"
                        onchange="updatePart(${index}, 'name', this.value)"
                        placeholder="Part Name"
                        class="px-3 py-2 border rounded"
                    />
                    <input
                        type="number"
                        value="${part.duration / 60}"
                        onchange="updatePart(${index}, 'duration', this.value)"
                        placeholder="Minutes"
                        class="px-3 py-2 border rounded"
                    />
                    <input
                        value="${part.speaker}"
                        onchange="updatePart(${index}, 'speaker', this.value)"
                        placeholder="Speaker"
                        class="px-3 py-2 border rounded"
                    />
                </div>
                <button onclick="movePart(${index}, -1)" ${index === 0 ? 'disabled' : ''} class="px-3 py-2 bg-gray-200 rounded">↑</button>
                <button onclick="movePart(${index}, 1)" ${index === meetingParts.length - 1 ? 'disabled' : ''} class="px-3 py-2 bg-gray-200 rounded">↓</button>
                <button onclick="removePart(${index})" class="px-3 py-2 bg-gray-200 rounded">×</button>
            </div>
    `).join('');
}
        
        // MODIFIED renderTimerDisplay() function
        function renderTimerDisplay() {
            const container = document.getElementById('partsDisplay');
            container.innerHTML = meetingParts.map((part, index) => {
                const elapsed = elapsedTimes[index] || 0;
                const { progress, color } = getProgressInfo(elapsed, part.duration);
                
                return `
                    <div
                        class="p-4 border rounded-lg cursor-pointer part-card ${activePart === index ? 'border-blue-500' : ''}"
                        onclick="selectPart(${index})"
                    >
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">${part.name}</span>
                            <span>${part.speaker}</span>
                        </div>
                        <div class="h-8 bg-gray-200 rounded-full overflow-hidden relative">
                            <div
                                class="h-full ${color} progress-bar absolute"
                                style="width: ${progress}%"
                            >
                                <span class="absolute left-2 text-white">
                                    ${formatTime(elapsed)}
                                </span>
                            </div>
                            <span class="absolute right-2">
                                ${formatTime(part.duration - elapsed)}
                            </span>
                        </div>
                        <!-- NEW: MOVED TIMER CONTROLS HERE -->
                        ${activePart === index ? `
                        <div class="mt-4 flex space-x-2">
                            <button onclick="toggleTimer()" 
                                    class="px-4 py-2 ${isRunning ? 'bg-red-500' : 'bg-blue-500'} text-white rounded hover:bg-blue-600"
                                    ${isRunning ? 'disabled' : ''}>
                                ${isRunning ? 'Pause' : 'Resume'}
                            </button>
                            <button onclick="startNextPart()" 
                                    class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                    ${activePart >= meetingParts.length - 1 ? 'disabled' : ''}>
                                Begin Next Part
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // MODIFIED selectPart() function
        function selectPart(index) {
            if (isRunning) {
                alert('Cannot switch parts while timer is active!');
                return;
            }
            activePart = index;
            renderTimerDisplay();
            updateCommentSection();
        }

        // MODIFIED toggleTimer() function
        function toggleTimer() {
            if (activePart === null) return;
            isRunning = !isRunning;
            renderTimerDisplay(); // NEW: Update button states through re-render
            
            if (isRunning) {
                timerInterval = setInterval(updateTimer, 1000);
            } else {
                clearInterval(timerInterval);
            }
        }

       document.addEventListener('DOMContentLoaded', () => {
           loadTemplate();
       });
    </script>
</body>
</html>
